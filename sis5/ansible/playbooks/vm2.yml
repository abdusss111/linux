---
# VM2 Playbook: Backend/Database Setup Only
# Use this to setup only the backend VM

- name: Setup VM2 - Backend
  hosts: backend
  become: true
  gather_facts: true

  pre_tasks:
    - name: Update apt cache
      ansible.builtin.apt:
        update_cache: true
        cache_valid_time: 3600

  roles:
    - role: users
    - role: permissions
    - role: ssh
    - role: firewall
    - role: docker
    - role: services
    - role: cron

  post_tasks:
    - name: Verify backend container is running
      ansible.builtin.command: docker ps --filter name=dapmeet-backend --format "{{ '{{' }}.Status{{ '}}' }}"
      register: container_status
      changed_when: false

    - name: Display backend status
      ansible.builtin.debug:
        msg: "Backend container status: {{ container_status.stdout }}"

