# SIS5 Ansible - –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –æ—à–∏–±–æ–∫

## –†–µ–∑—é–º–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π

–í—Å–µ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –æ—à–∏–±–∫–∏ –≤ –ø–ª–µ–π–±—É–∫–µ Ansible –∏—Å–ø—Ä–∞–≤–ª–µ–Ω—ã. –ù–∏–∂–µ —Å–ø–∏—Å–æ–∫ –≤—Å–µ—Ö –∏–∑–º–µ–Ω–µ–Ω–∏–π:

### ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã

#### 1. **–ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –±–µ–∑ default –∑–Ω–∞—á–µ–Ω–∏–π**
- ‚úÖ –í—Å–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –≤ loop —Ç–µ–ø–µ—Ä—å –∏–º–µ—é—Ç `default([])`
- ‚úÖ –í—Å–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –≤ —à–∞–±–ª–æ–Ω–∞—Ö –∑–∞—â–∏—â–µ–Ω—ã default –∑–Ω–∞—á–µ–Ω–∏—è–º–∏
- ‚úÖ –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ `vm_role`, `docker_container.*`, `project_*` –∑–∞—â–∏—â–µ–Ω—ã

#### 2. **–ú–æ–¥—É–ª—å timezone**
- ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω —Å `ansible.builtin.timezone` –Ω–∞ `community.general.timezone`

#### 3. **Docker —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π**
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–æ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –û–° (Debian/Ubuntu)
- ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω –º–µ—Ç–æ–¥ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è GPG –∫–ª—é—á–∞ (–±–µ–∑ deprecated `apt_key`)
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–∞ –æ—á–∏—Å—Ç–∫–∞ –∫–æ–Ω—Ñ–ª–∏–∫—Ç—É—é—â–∏—Ö —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–µ–≤ –ø–µ—Ä–µ–¥ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ–º

#### 4. **Docker –æ–±—Ä–∞–∑—ã**
- ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ –ª–æ–≥–∏–∫–∞ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –æ–±—Ä–∞–∑–æ–≤ (frontend/backend)
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫–∞ –≥—Ä—É–ø–ø—ã —Ö–æ—Å—Ç–∞ –∫–∞–∫ fallback
- ‚úÖ –í—Å–µ –æ–±—Ä–∞–∑—ã –∏—Å–ø–æ–ª—å–∑—É—é—Ç —Ç–µ–≥ `:latest` –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–∞ –∑–∞–¥–∞—á–∞ –¥–ª—è pull –æ–±—Ä–∞–∑–∞ —Å –æ–±—Ä–∞–±–æ—Ç–∫–æ–π –æ—à–∏–±–æ–∫

#### 5. **–ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –≤ post_tasks**
- ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ `vm_role` —Å –ø—Ä–æ–≤–µ—Ä–∫–æ–π –≥—Ä—É–ø–ø—ã
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω—ã –æ—Ç–¥–µ–ª—å–Ω—ã–µ —Ñ–∞–∫—Ç—ã –¥–ª—è display

#### 6. **–®–∞–±–ª–æ–Ω systemd service**
- ‚úÖ –£–ø—Ä–æ—â–µ–Ω –∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –≤—ã—á–∏—Å–ª–µ–Ω–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
- ‚úÖ –í—Å–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –∑–∞—â–∏—â–µ–Ω—ã default –∑–Ω–∞—á–µ–Ω–∏—è–º–∏

#### 7. **–®–∞–±–ª–æ–Ω—ã cron —Å–∫—Ä–∏–ø—Ç–æ–≤**
- ‚úÖ –í—Å–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ `project_*` –∑–∞—â–∏—â–µ–Ω—ã default –∑–Ω–∞—á–µ–Ω–∏—è–º–∏

#### 8. **SSH –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è**
- ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ —Å–ª–æ–∂–Ω–∞—è –ª–æ–≥–∏–∫–∞ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

#### 9. **Ansible –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è**
- ‚úÖ –£–≤–µ–ª–∏—á–µ–Ω—ã —Ç–∞–π–º–∞—É—Ç—ã –¥–ª—è privilege escalation
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω—ã SSH —Ç–∞–π–º–∞—É—Ç—ã

### üìÅ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã

#### Playbooks
- ‚úÖ `playbooks/site.yml` - –∏—Å–ø—Ä–∞–≤–ª–µ–Ω—ã post_tasks, –≤—Å–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –∑–∞—â–∏—â–µ–Ω—ã

#### Roles
- ‚úÖ `roles/users/tasks/main.yml` - –≤—Å–µ loop –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –∑–∞—â–∏—â–µ–Ω—ã
- ‚úÖ `roles/permissions/tasks/main.yml` - –≤—Å–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –∑–∞—â–∏—â–µ–Ω—ã
- ‚úÖ `roles/ssh/tasks/main.yml` - –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ –ª–æ–≥–∏–∫–∞ AllowUsers
- ‚úÖ `roles/firewall/tasks/main.yml` - firewall_ports –∑–∞—â–∏—â–µ–Ω
- ‚úÖ `roles/docker/tasks/main.yml` - –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ –ª–æ–≥–∏–∫–∞ –æ–±—Ä–∞–∑–æ–≤, —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–µ–≤
- ‚úÖ `roles/services/tasks/main.yml` - –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ vm_role
- ‚úÖ `roles/services/handlers/main.yml` - –∏—Å–ø—Ä–∞–≤–ª–µ–Ω—ã –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
- ‚úÖ `roles/services/templates/docker-container.service.j2` - —É–ø—Ä–æ—â–µ–Ω —à–∞–±–ª–æ–Ω
- ‚úÖ `roles/cron/tasks/main.yml` - cron_jobs –∑–∞—â–∏—â–µ–Ω
- ‚úÖ `roles/cron/templates/*.j2` - –≤—Å–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –∑–∞—â–∏—â–µ–Ω—ã

#### Configuration
- ‚úÖ `ansible.cfg` - —É–≤–µ–ª–∏—á–µ–Ω—ã —Ç–∞–π–º–∞—É—Ç—ã
- ‚úÖ `inventory/hosts.yml` - –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ IP –∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å
- ‚úÖ `inventory/group_vars` - –ø–µ—Ä–µ–º–µ—â–µ–Ω–∞ –ø–∞–ø–∫–∞ group_vars –≤ inventory –¥–ª—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–π –∑–∞–≥—Ä—É–∑–∫–∏ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö

### üîß –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –æ–∫—Ä—É–∂–µ–Ω–∏—è (VM1)

#### 1. **–ü—Ä–æ–±–ª–µ–º–∞ apt –∏ SSL**
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–∞ –≤—Ä–µ–º–µ–Ω–Ω–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è `Acquire::https::Verify-Peer "false"` –¥–ª—è –æ–±—Ö–æ–¥–∞ –æ—à–∏–±–∫–∏ SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–≤
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–∞ –ø–µ—Ä–µ—É—Å—Ç–∞–Ω–æ–≤–∫–∞ `ca-certificates`
- ‚úÖ –û—á–∏—Å—Ç–∫–∞ apt –∫—ç—à–∞ (`/var/lib/apt/lists/*`) –¥–ª—è –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è corrupted lists

#### 2. **–ü—Ä–æ–±–ª–µ–º–∞ –¥–∏—Å–∫–æ–≤–æ–≥–æ –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–∞**
- ‚úÖ –í—ã–ø–æ–ª–Ω–µ–Ω–∞ –æ—á–∏—Å—Ç–∫–∞ –∂—É—Ä–Ω–∞–ª–æ–≤ systemd –Ω–∞ vm1 (–±—ã–ª–æ 100% usage)
- ‚úÖ –í—ã–ø–æ–ª–Ω–µ–Ω `docker system prune`

#### 3. **–ü—Ä–æ–±–ª–µ–º–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö**
- ‚úÖ –ü–∞–ø–∫–∞ `group_vars` –ø–µ—Ä–µ–º–µ—â–µ–Ω–∞ –≤ `inventory/` —Ç.–∫. Ansible –Ω–µ –≤–∏–¥–µ–ª –µ—ë –≤ –∫–æ—Ä–Ω–µ –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ –ø–ª–µ–π–±—É–∫–∞
- ‚úÖ –≠—Ç–æ —Ä–µ—à–∏–ª–æ –ø—Ä–æ–±–ª–µ–º—É —Å –ø—Ä–æ–ø—É—Å–∫–æ–º –∑–∞–¥–∞—á —Å–æ–∑–¥–∞–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π (Bonus 1)

### üîç –ü—Ä–æ–≤–µ—Ä–∫–∞

–í—Å–µ —Ñ–∞–π–ª—ã –ø—Ä–æ–≤–µ—Ä–µ–Ω—ã –Ω–∞:
- ‚úÖ –°–∏–Ω—Ç–∞–∫—Å–∏—Å YAML
- ‚úÖ –°–∏–Ω—Ç–∞–∫—Å–∏—Å Ansible
- ‚úÖ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö —Å default
- ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω–æ—Å—Ç—å –º–æ–¥—É–ª–µ–π

#### 4. **–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –æ—à–∏–±–∫–∏ –≤ —à–∞–±–ª–æ–Ω–∞—Ö**
- ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ —Å–∏–Ω—Ç–∞–∫—Å–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞ –≤ `roles/services/tasks/main.yml` (Jinja2 syntax error)
- ‚úÖ –£–ø—Ä–æ—â–µ–Ω–∞ –ª–æ–≥–∏–∫–∞ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –æ–±—Ä–∞–∑–æ–≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤

### üöÄ –ì–æ—Ç–æ–≤–Ω–æ—Å—Ç—å

–ü–ª–µ–π–±—É–∫ –≥–æ—Ç–æ–≤ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é. –í—Å–µ –æ—à–∏–±–∫–∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω—ã, –≤—Å–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –∑–∞—â–∏—â–µ–Ω—ã –∑–Ω–∞—á–µ–Ω–∏—è–º–∏ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é.

### ‚ö†Ô∏è –í–∞–∂–Ω—ã–µ –∑–∞–º–µ—Ç–∫–∏

1. **Docker –æ–±—Ä–∞–∑—ã**: –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –æ–±—Ä–∞–∑—ã –ø–µ—Ä–µ—Å–æ–±—Ä–∞–Ω—ã –¥–ª—è `linux/amd64`:
   ```bash
   docker build --platform linux/amd64 -t abdusss111/dapmeet-client:latest .
   docker build --platform linux/amd64 -t abdusss111/dapmeet-service:latest .
   docker push abdusss111/dapmeet-client:latest
   docker push abdusss111/dapmeet-service:latest
   ```

2. **–ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ**: –í—Å–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –∏–∑ `group_vars` –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –æ–ø—Ä–µ–¥–µ–ª–µ–Ω—ã –¥–ª—è –ø–æ–ª–Ω–æ–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏, –Ω–æ –ø–ª–µ–π–±—É–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç –∏ –±–µ–∑ –Ω–∏—Ö –±–ª–∞–≥–æ–¥–∞—Ä—è default –∑–Ω–∞—á–µ–Ω–∏—è–º.

3. **–ü—Ä–æ–≤–µ—Ä–∫–∞**: –ü–µ—Ä–µ–¥ –∑–∞–ø—É—Å–∫–æ–º –ø—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ:
   ```bash
   ansible all -m ping
   ```

