## Privileged Command Audit Rules
## Managed by Ansible - SIS6

# ============================================================================
# USER MANAGEMENT COMMANDS
# ============================================================================

{% for cmd in audit_rules.privileged_commands %}
# Monitor {{ cmd | basename }}
-a always,exit -F path={{ cmd }} -F perm=x -F auid>=1000 -F auid!=4294967295 -k privileged_cmd
{% endfor %}

# ============================================================================
# ADDITIONAL PRIVILEGED COMMANDS
# ============================================================================

# Monitor chown/chmod operations on critical files
-a always,exit -F arch=b64 -S chmod -S fchmod -S fchmodat -F auid>=1000 -F auid!=4294967295 -k permission_changes
-a always,exit -F arch=b32 -S chmod -S fchmod -S fchmodat -F auid>=1000 -F auid!=4294967295 -k permission_changes

-a always,exit -F arch=b64 -S chown -S fchown -S fchownat -S lchown -F auid>=1000 -F auid!=4294967295 -k ownership_changes
-a always,exit -F arch=b32 -S chown -S fchown -S fchownat -S lchown -F auid>=1000 -F auid!=4294967295 -k ownership_changes

# Monitor attribute changes
-a always,exit -F arch=b64 -S setxattr -S lsetxattr -S fsetxattr -S removexattr -S lremovexattr -S fremovexattr -F auid>=1000 -F auid!=4294967295 -k attribute_changes
-a always,exit -F arch=b32 -S setxattr -S lsetxattr -S fsetxattr -S removexattr -S lremovexattr -S fremovexattr -F auid>=1000 -F auid!=4294967295 -k attribute_changes

# ============================================================================
# CRON AND SCHEDULED TASKS
# ============================================================================

# Monitor crontab changes
-w /etc/crontab -p wa -k cron_changes
-w /etc/cron.d -p wa -k cron_changes
-w /etc/cron.daily -p wa -k cron_changes
-w /etc/cron.hourly -p wa -k cron_changes
-w /etc/cron.weekly -p wa -k cron_changes
-w /etc/cron.monthly -p wa -k cron_changes
-w /var/spool/cron -p wa -k cron_changes

# Monitor at job changes
-w /var/spool/at -p wa -k at_changes

# ============================================================================
# SYSTEMD SERVICE CHANGES
# ============================================================================

# Monitor systemd unit files
-w /etc/systemd/system -p wa -k systemd_changes
-w /usr/lib/systemd/system -p wa -k systemd_changes
-w /run/systemd/system -p wa -k systemd_changes

